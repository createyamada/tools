Sub ShowNonOverlappingTESTNames()
    Dim selectedCols As Range
    Dim fullRange As Range
    Dim col As Range, cell As Range
    Dim selectedRowsDict As Object
    Dim result As String
    Dim rowIdx As Long
    Dim testName As String
    Dim compareCol As Range
    Dim isOverlapping As Boolean

    Set fullRange = Range("D4:R33") ' 全体のチェック範囲
    Set selectedCols = Intersect(Selection, fullRange)

    If selectedCols Is Nothing Then
        MsgBox "D4:R33 の範囲から列を選択してください。", vbExclamation
        Exit Sub
    End If

    ' 選択された列の ○ がある行番号を収集
    Set selectedRowsDict = CreateObject("Scripting.Dictionary")
    For Each col In selectedCols.Columns
        For Each cell In col.Cells
            If Trim(cell.Value) = "○" Then
                selectedRowsDict(cell.Row) = True
            End If
        Next cell
    Next col

    ' 他の列で、○ の行が選択列と重複していない列だけを抽出
    result = ""
    For Each col In fullRange.Columns
        If Intersect(col, selectedCols) Is Nothing Then ' 選択されてない列のみチェック
            isOverlapping = False
            For Each cell In col.Cells
                If Trim(cell.Value) = "○" Then
                    If selectedRowsDict.exists(cell.Row) Then
                        isOverlapping = True
                        Exit For
                    End If
                End If
            Next cell

            ' 重複がなかったら、3行目のテスト名を結果に追加
            If Not isOverlapping Then
                testName = Cells(3, col.Column).Value
                result = result & testName & vbCrLf
            End If
        End If
    Next col

    ' 結果表示
    If result = "" Then
        MsgBox "○ が重複していない列はありませんでした。", vbInformation
    Else
        MsgBox "○ が重複しない列（3行目のテスト名）:" & vbCrLf & result, vbInformation
    End If
End Sub
