for pid in /proc/[0-9]*; do
  pidnum=$(basename "$pid")
  if [ -d "$pid/fd" ]; then
    count=$(ls -U "$pid/fd" 2>/dev/null | wc -l)
    cmd=$(tr -d '\0' < "$pid/comm" 2>/dev/null)
    echo "$count $pidnum $cmd"
  fi
done | sort -nr | head
